<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Way Together — Inscription</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- CSS personnalisé -->
    <link href="../fichiers/css/base.css" rel="stylesheet" />
    <link href="../fichiers/css/buttons.css" rel="stylesheet" />
  </head>

  <body class="bg-light d-flex justify-content-center align-items-center">
    <div
      class="card shadow-sm p-4"
      style="width: 100%; max-width: 400px; border-radius: 1rem"
    >
      <div class="text-center mb-4">
        <img src="../images/logo.png" alt="Way Together" height="60" />
        <h2 class="fw-bold mt-3">Inscription</h2>
      </div>

      <form id="signupForm" action="../fichiers/php/signup.php" method="POST">
        <div class="mb-3">
          <label for="nom" class="form-label">Nom</label>
          <input
            type="text"
            class="form-control"
            name="nom"
            placeholder="Dupont"
            required
          />
        </div>

        <div class="mb-3">
          <label for="prenom" class="form-label">Prenom</label>
          <input
            type="text"
            class="form-control"
            id="prenom"
            name="prenom"
            placeholder="Jean"
            required
          />
        </div>

        <div class="mb-3">
          <label for="age" class="form-label">Age</label>
          <input
            type="number"
            class="form-control"
            id="age"
            name="age"
            placeholder="33"
            required
          />
        </div>

        <div class="mb-3">
          <label for="email" class="form-label">Adresse email</label>
          <input
            type="email"
            class="form-control"
            id="email"
            name="email"
            placeholder="exemple@email.com"
            required
          />
        </div>

        <div class="mb-3">
          <label for="phone" class="form-label">Telephone</label>
          <input
            type="tel"
            class="form-control"
            id="phone"
            name="telephone"
            placeholder="06 12 34 56 78"
            required
          />
        </div>

        <div class="mb-3">
          <label for="password" class="form-label">Mot de passe</label>
          <input
            type="password"
            class="form-control"
            id="password"
            name="mot_de_passe"
            placeholder="Mot de passe"
            required
          />
        </div>

        <div class="mb-3">
          <label for="confirm_password" class="form-label"
            >Confirmer le mot de passe</label
          >
          <input
            type="password"
            class="form-control"
            id="confirm_password"
            name="confirm_password"
            placeholder="Confirmer le mot de passe"
            required
          />
          <p id="message"></p>
        </div>

        <button type="submit" id="submitBtn" class="btn btn-primary w-100 mb-3">
          S'inscrire
        </button>
      </form>
      <script>
        const password = document.getElementById("password");
        const confirm = document.getElementById("confirm_password");
        const message = document.getElementById("message");
        const submitBtn = document.getElementById("submitBtn");

        function checkPasswords() {
          if (confirm.value === "") {
            message.textContent = "";
            submitBtn.disabled = true;
          } else if (password.value === confirm.value) {
            message.textContent = "✅ Les mots de passe correspondent";
            message.style.color = "green";
            submitBtn.disabled = false; // bouton activé
          } else {
            message.textContent = "❌ Les mots de passe ne correspondent pas";
            message.style.color = "red";
            submitBtn.disabled = true; // bouton désactivé
          }
        }

        password.addEventListener("input", checkPasswords);
        confirm.addEventListener("input", checkPasswords);
      </script>

      <div class="modal fade" id="resultModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Création du compte</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body" id="modalMessage"></div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-primary"
                data-bs-dismiss="modal"
              >
                OK
              </button>
            </div>
          </div>
        </div>
      </div>

      <script>
        const form = document.getElementById("signupForm");
        const modalEl = document.getElementById("resultModal");
        const modalMsg = document.getElementById("modalMessage");
        const modal = new bootstrap.Modal(modalEl);

        let isSuccess = false;

        form.addEventListener("submit", function (e) {
          e.preventDefault();

          const formData = new FormData(form);

          fetch(form.action, {
            method: "POST",
            body: formData,
          })
            .then((response) => response.text())
            .then((data) => {
              // Détermine succès via contenu
              isSuccess = data.includes("✅") || /succès|réussi/i.test(data);

              modalMsg.textContent = data;
              modal.show();
            })
            .catch((error) => {
              isSuccess = false;
              modalMsg.textContent = "❌ Une erreur est survenue : " + error;
              modal.show();
            });
        });

        // Redirection uniquement si succès
        modalEl.addEventListener("hidden.bs.modal", function () {
          if (isSuccess) {
            window.location.href = "../index.php";
          }
        });
      </script>

      <p class="text-center">
        Vous avez déjà un compte ? <a href="login.html">Se connecter</a>
      </p>
      <div class="mb-3 text-start">
        <a href="../index.php" class="text-decoration-none"
          >&larr; Retour à l'accueil</a
        >
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
